# 디버깅 가이드

## 개요

이 프로젝트는 DD(Dump and Die)와 로그를 활용한 빠른 디버깅 방식을 사용합니다.

## 설정된 디버깅 환경

### 1. 디버그 모드 활성화
- `config/app.php`: `'debug' => true`
- 상세한 에러 메시지 표시
- 스택 트레이스 제공

### 2. 로그 채널 설정
- **debug**: `storage/logs/debug.log`
- **sql**: `storage/logs/sql.log`
- **laravel**: `storage/logs/laravel.log`

### 3. SQL 쿼리 자동 로깅
- 모든 SQL 쿼리가 `sql.log`에 기록
- 쿼리 실행 시간 포함

## 디버깅 방법

### 1. DD (Dump and Die) 사용법

```php
// 기본 DD
dd($variable);

// 로그와 함께 DD
dd_log($variable, '사용자 데이터');

// 배열/객체 구조 확인
dd($user->toArray());
dd($request->all());
```

### 2. 로그 확인 방법

#### 실시간 로그 모니터링
```bash
# 디버그 로그
wsl docker-compose exec laravel.test tail -f storage/logs/debug.log

# SQL 로그
wsl docker-compose exec laravel.test tail -f storage/logs/sql.log

# 전체 로그
wsl docker-compose exec laravel.test tail -f storage/logs/laravel.log
```

#### 로그 파일 위치
- `storage/logs/debug.log`: 디버그 정보
- `storage/logs/sql.log`: SQL 쿼리
- `storage/logs/laravel.log`: 일반 로그

### 3. 헬퍼 함수 사용법

```php
// 디버그 로그
log_debug($data, '사용자 정보');

// SQL 로그
log_sql('SELECT * FROM users WHERE id = ?', [1]);

// 요청 정보 디버그
debug_request();

// 세션 정보 디버그
debug_session();
```

## 실제 사용 예시

### 1. 컨트롤러에서 디버깅

```php
public function store(Request $request)
{
    // 요청 데이터 확인
    dd_log($request->all(), '유지보수 요청 데이터');
    
    // 사용자 정보 확인
    dd_log(auth()->user(), '현재 로그인 사용자');
    
    // 데이터베이스 쿼리 확인
    $requests = MaintenanceRequest::where('user_id', auth()->id())->get();
    dd_log($requests, '사용자의 유지보수 요청');
    
    // 정상 처리
    return redirect()->back()->with('success', '요청이 생성되었습니다.');
}
```

### 2. 모델에서 디버깅

```php
public function scopeActive($query)
{
    log_debug('Active 스코프 실행');
    return $query->where('is_active', true);
}

protected static function booted()
{
    static::created(function ($model) {
        log_debug($model->toArray(), '새 모델 생성됨');
    });
}
```

### 3. 뷰에서 디버깅

```php
{{-- Blade 템플릿에서 --}}
@php
    log_debug($users, '뷰에서 사용자 목록');
@endphp

{{-- 또는 간단히 --}}
{{ dd($users) }}
```

## 브라우저에서 디버깅

### 1. 개발자 도구 활용
```javascript
// 콘솔에서 데이터 확인
console.log('사용자 데이터:', @json($users));

// 네트워크 탭에서 API 응답 확인
// Elements 탭에서 HTML 구조 확인
```

### 2. Laravel Debugbar (선택사항)
```bash
composer require barryvdh/laravel-debugbar --dev
```

## 로그 레벨별 사용법

### Debug (개발 중)
```php
log_debug($data, '디버그 정보');
```

### Info (일반 정보)
```php
Log::info('사용자 로그인', ['user_id' => $user->id]);
```

### Warning (경고)
```php
Log::warning('잘못된 로그인 시도', ['login_id' => $loginId]);
```

### Error (오류)
```php
Log::error('데이터베이스 연결 실패', ['error' => $e->getMessage()]);
```

## 성능 최적화

### 1. 로그 파일 관리
```bash
# 로그 파일 크기 확인
wsl docker-compose exec laravel.test ls -lh storage/logs/

# 오래된 로그 정리
wsl docker-compose exec laravel.test find storage/logs/ -name "*.log" -mtime +7 -delete
```

### 2. 프로덕션 환경
- `APP_DEBUG=false` 설정
- 로그 레벨을 `error`로 변경
- 불필요한 로그 제거

## 문제 해결

### 1. 로그 파일이 생성되지 않는 경우
```bash
# 로그 디렉토리 권한 확인
wsl docker-compose exec laravel.test chmod -R 775 storage/logs/

# 로그 파일 생성
wsl docker-compose exec laravel.test touch storage/logs/debug.log
```

### 2. SQL 로그가 안 보이는 경우
```php
// 수동으로 SQL 로그 확인
DB::enableQueryLog();
// 쿼리 실행
$results = User::all();
dd(DB::getQueryLog());
```

### 3. DD가 작동하지 않는 경우
```php
// 대안 방법
var_dump($variable);
exit;
```

## 모범 사례

### 1. 개발 단계별 디버깅
- **초기 개발**: DD로 빠른 확인
- **기능 완성**: 로그로 추적
- **최적화**: 성능 로그 확인

### 2. 로그 메시지 작성법
```php
// 좋은 예
log_debug($user, '사용자 로그인 성공');

// 나쁜 예
log_debug($user, 'test');
```

### 3. 보안 고려사항
- 민감한 정보는 로그에 기록하지 않음
- 프로덕션에서는 디버그 정보 제거
- 로그 파일 접근 권한 제한

## 추가 도구

### 1. Laravel Telescope (선택사항)
```bash
composer require laravel/telescope --dev
php artisan telescope:install
```

### 2. Laravel IDE Helper
```bash
composer require --dev barryvdh/laravel-ide-helper
php artisan ide-helper:generate
```

이제 DD와 로그를 활용한 빠른 디버깅 환경이 완성되었습니다! 
