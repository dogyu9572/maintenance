# 유지보수 게시판 DB 설계 및 작업 계획
> Laravel 12 기반 시스템 구축 가이드

## 📋 프로젝트 개요

**프로젝트명**: 홈페이지코리아 유지보수 게시판  
**기술스택**: Laravel 12, PHP 8.4, MySQL 8.0  
**분석일**: 2024년 12월  
**목표**: 기존 PHP 프로젝트를 Laravel로 완전 마이그레이션

---

## 🏗️ 시스템 구조 분석

### 사용자 시스템
```
사용자 (Client)
├── 대시보드 (main.php)
├── 유지보수 요청 관리
│   ├── 목록 조회 (maintenance_requests.php)
│   ├── 상세 보기 (maintenance_requests_view.php)
│   └── 요청 작성 (maintenance_requests_write.php)
├── 월간보고서 조회 (monthly_reports.php)
├── 공지사항 조회 (notices.php)
├── 알림내역 (notifications.php)
└── 계정 정보 (account_information.php)
```

### 관리자 시스템
```
관리자 (Admin)
├── 관리자 대시보드 (main_adm.php)
├── 고객사 관리
├── 유지보수 요청 관리
│   ├── 목록 관리 (maintenance_requests.php)
│   ├── 상세 관리 (maintenance_requests_view.php)
│   └── 요청 작성 (maintenance_requests_write.php)
├── 월간보고서 관리
│   ├── 목록 관리 (monthly_reports.php)
│   ├── 작성 관리 (monthly_reports_write.php)
│   └── 인쇄 기능 (monthly_reports_print.php)
├── 공지사항 관리
│   ├── 목록 관리 (notices.php)
│   ├── 상세 관리 (notices_view.php)
│   └── 작성 관리 (notices_write.php)
└── 계정 관리 (account.php, account_adm.php)
```

---

## 🗄️ 데이터베이스 설계

### 1. 핵심 테이블

#### users (사용자/관리자)
```sql
- idx (PK, Auto Increment)
- name (이름)
- email (이메일)
- password (비밀번호)
- phone (연락처)
- position (직급)
- role (역할: user/admin)
- client_id (FK, 고객사 ID)
- is_active (활성화 여부)
- created_at, updated_at
```

#### clients (고객사)
```sql
- idx (PK, Auto Increment)
- name (고객사명)
- contract_start (계약 시작일)
- contract_end (계약 종료일)
- website_url (홈페이지 URL)
- created_at, updated_at
```

#### maintenance_requests (유지보수 요청)
```sql
- idx (PK, Auto Increment)
- user_id (FK, 요청자 ID)
- client_id (FK, 고객사 ID)
- manager_id (FK, 담당자 ID)
- worker_id (FK, 작업자 ID)
- type_id (FK, 유지보수 종류 ID)
- status_id (FK, 상태 ID)
- title (제목)
- content (내용)
- request_date (요청일)
- expected_date (처리예정일)
- completed_date (완료일)
- created_at, updated_at
```

#### monthly_reports (월간보고서)
```sql
- idx (PK, Auto Increment)
- client_id (FK, 고객사 ID)
- user_id (FK, 작성자 ID)
- year (년도)
- month (월)
- title (제목)
- content (내용)
- status (상태: draft/published)
- created_at, updated_at
```

#### notices (공지사항)
```sql
- idx (PK, Auto Increment)
- user_id (FK, 작성자 ID)
- title (제목)
- content (내용)
- is_important (중요 공지 여부)
- created_at, updated_at
```

#### notifications (알림)
```sql
- idx (PK, Auto Increment)
- user_id (FK, 수신자 ID)
- type (알림 타입)
- title (제목)
- content (내용)
- is_read (읽음 여부)
- created_at, updated_at
```

### 2. 관계 테이블

#### maintenance_types (유지보수 종류)
```sql
- idx (PK, Auto Increment)
- name (종류명)
- description (설명)
- created_at, updated_at
```

#### request_statuses (요청 상태)
```sql
- idx (PK, Auto Increment)
- name (상태명)
- color (색상)
- order (순서)
- created_at, updated_at
```

#### attachments (첨부파일)
```sql
- idx (PK, Auto Increment)
- request_id (FK, 요청 ID)
- file_name (파일명)
- file_path (파일 경로)
- file_size (파일 크기)
- file_type (파일 타입)
- created_at, updated_at
```

---

## 🔄 오류 최소화 작업 방식

### Phase 1: 데이터베이스 설계 (1-2일)

#### 1.1 마이그레이션 생성
```bash
# 단계별 마이그레이션 생성
1. 기본 테이블 (users, clients)
2. 관계 테이블 (maintenance_types, request_statuses)
3. 핵심 테이블 (maintenance_requests, monthly_reports, notices)
4. 부가 테이블 (notifications, attachments)
```

#### 1.2 시더 생성
```bash
# 기본 데이터 생성
1. 관리자 계정 생성
2. 유지보수 종류 데이터
3. 요청 상태 데이터
4. 테스트용 고객사 데이터
```

### Phase 2: 모델 및 관계 설정 (1-2일)

#### 2.1 모델 생성
```bash
# 순서대로 모델 생성
1. User, Client 모델
2. MaintenanceType, RequestStatus 모델
3. MaintenanceRequest, MonthlyReport, Notice 모델
4. Notification, Attachment 모델
```

#### 2.2 관계 설정
```bash
# 각 모델의 관계 설정
1. User ↔ Client (belongsTo)
2. MaintenanceRequest ↔ User, Client, Manager, Worker (belongsTo)
3. MaintenanceRequest ↔ MaintenanceType, RequestStatus (belongsTo)
4. MonthlyReport ↔ Client, User (belongsTo)
5. Notice ↔ User (belongsTo)
6. Notification ↔ User (belongsTo)
7. Attachment ↔ MaintenanceRequest (belongsTo)
```

### Phase 3: 컨트롤러 구현 (2-3일)

#### 3.1 기본 CRUD 컨트롤러
```bash
# 순서대로 컨트롤러 생성
1. UserController, ClientController
2. MaintenanceRequestController
3. MonthlyReportController
4. NoticeController
5. NotificationController
```

#### 3.2 관리자 컨트롤러
```bash
# 관리자 전용 컨트롤러
1. AdminMaintenanceRequestController
2. AdminMonthlyReportController
3. AdminNoticeController
4. AdminClientController
```

### Phase 4: 뷰 템플릿 변환 (3-4일)

#### 4.1 레이아웃 템플릿
```bash
# 기존 PHP 템플릿을 블레이드로 변환
1. _header.php → layouts/app.blade.php
2. _aside.php → layouts/sidebar.blade.php
3. _footer.php → layouts/footer.blade.php
```

#### 4.2 페이지 템플릿
```bash
# 사용자 페이지 변환
1. main.php → dashboard/index.blade.php
2. maintenance_requests.php → maintenance-requests/index.blade.php
3. maintenance_requests_view.php → maintenance-requests/show.blade.php
4. maintenance_requests_write.php → maintenance-requests/create.blade.php
5. monthly_reports.php → monthly-reports/index.blade.php
6. notices.php → notices/index.blade.php
7. notifications.php → notifications/index.blade.php
```

#### 4.3 관리자 페이지 변환
```bash
# 관리자 페이지 변환
1. main_adm.php → admin/dashboard/index.blade.php
2. page_adm/maintenance_requests.php → admin/maintenance-requests/index.blade.php
3. page_adm/monthly_reports.php → admin/monthly-reports/index.blade.php
4. page_adm/notices.php → admin/notices/index.blade.php
```

### Phase 5: 라우트 설정 (1일)

#### 5.1 사용자 라우트
```php
Route::middleware(['auth'])->group(function () {
    Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');
    Route::resource('maintenance-requests', MaintenanceRequestController::class);
    Route::resource('monthly-reports', MonthlyReportController::class);
    Route::resource('notices', NoticeController::class);
    Route::get('/notifications', [NotificationController::class, 'index'])->name('notifications');
    Route::get('/account', [AccountController::class, 'show'])->name('account');
});
```

#### 5.2 관리자 라우트
```php
Route::middleware(['auth', 'admin'])->prefix('admin')->group(function () {
    Route::get('/dashboard', [AdminDashboardController::class, 'index'])->name('admin.dashboard');
    Route::resource('maintenance-requests', AdminMaintenanceRequestController::class);
    Route::resource('monthly-reports', AdminMonthlyReportController::class);
    Route::resource('notices', AdminNoticeController::class);
    Route::resource('clients', AdminClientController::class);
});
```

---

## 🛡️ 오류 최소화 전략

### 1. 단계별 검증
```bash
# 각 단계마다 검증
1. 마이그레이션 실행 후 테이블 구조 확인
2. 모델 생성 후 관계 테스트
3. 컨트롤러 생성 후 기본 CRUD 테스트
4. 뷰 생성 후 화면 표시 확인
```

### 2. 백업 및 롤백
```bash
# 각 단계 전 백업
1. git commit으로 현재 상태 저장
2. 데이터베이스 백업
3. 문제 발생 시 이전 상태로 롤백
```

### 3. 테스트 우선
```bash
# 기능 구현과 동시에 테스트
1. 단위 테스트 작성
2. 기능 테스트 작성
3. 통합 테스트 작성
```

### 4. 점진적 구현
```bash
# 작은 단위로 나누어 구현
1. 한 번에 하나의 기능만 구현
2. 각 기능 완성 후 다음 기능 진행
3. 복잡한 기능은 더 작은 단위로 분할
```

---

## 📅 예상 작업 일정

### 전체 일정: 10-15일

#### Week 1: 기반 구축
- **Day 1-2**: DB 설계 및 마이그레이션
- **Day 3-4**: 모델 및 관계 설정
- **Day 5**: 기본 컨트롤러 구현

#### Week 2: 기능 구현
- **Day 6-8**: 핵심 기능 컨트롤러 구현
- **Day 9-10**: 관리자 기능 구현

#### Week 3: UI 구현
- **Day 11-13**: 뷰 템플릿 변환
- **Day 14-15**: 라우트 설정 및 최종 테스트

---

## 🚀 즉시 시작 가능한 작업

### 1단계: 기본 테이블 마이그레이션
```bash
"users, clients, maintenance_types, request_statuses 테이블의 마이그레이션을 생성해줘"
```

### 2단계: 기본 시더 생성
```bash
"기본 데이터를 위한 시더를 생성해줘"
```

### 3단계: 기본 모델 생성
```bash
"User, Client, MaintenanceType, RequestStatus 모델을 생성해줘"
```

---

## 📚 참고 자료

- [Laravel 12 공식 문서](https://laravel.com/docs)
- [Laravel Eloquent 관계 설정](https://laravel.com/docs/eloquent-relationships)
- [Laravel 마이그레이션 가이드](https://laravel.com/docs/migrations)
- [퍼블리싱 분석 문서](./퍼블리싱_분석_문서.md)
- [커서 개발 가이드](./커서_개발_가이드.md)

---

*이 문서는 체계적이고 안전한 Laravel 마이그레이션을 위한 가이드입니다.* 
